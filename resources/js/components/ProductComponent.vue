<template>
    <div class="row">
        <!--Left Part Start -->
        <aside id="column-left" class="col-sm-3 hidden-xs">
            <h3 class="subtitle">دسته ها</h3>
            <div class="box-category">
                <ul id="cat_accordion">
                    <li><a href="category.html">مد و زیبایی</a> <span class="down"></span>
                        <ul>
                            <li><a href="category.html">آقایان</a> <span class="down"></span>
                                <ul>
                                    <li><a href="category.html">زیردسته ها</a></li>
                                    <li><a href="category.html">زیردسته ها</a></li>
                                    <li><a href="category.html">زیردسته ها</a></li>
                                    <li><a href="category.html">زیردسته ها</a></li>
                                    <li><a href="category.html">زیردسته جدید</a></li>
                                </ul>
                            </li>
                            <li><a href="category.html">بانوان</a></li>
                            <li><a href="category.html">دخترانه</a> <span class="down"></span>
                                <ul>
                                    <li><a href="category.html">زیردسته ها</a></li>
                                    <li><a href="category.html">زیردسته جدید</a></li>
                                    <li><a href="category.html">زیردسته جدید</a></li>
                                </ul>
                            </li>
                            <li><a href="category.html">پسرانه</a></li>
                            <li><a href="category.html">نوزاد</a></li>
                            <li><a href="category.html">لوازم</a> <span class="down"></span>
                                <ul>
                                    <li><a href="category.html">زیردسته های جدید</a></li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li><a class="active" href="category.html">الکترونیکی</a> <span class="down"></span>
                        <ul style="display:block;">
                            <li><a href="category.html">لپ تاپ</a> <span class="down"></span>
                                <ul>
                                    <li><a href="category.html">زیردسته های جدید</a></li>
                                    <li><a href="category.html">زیردسته های جدید</a></li>
                                    <li><a href="category.html">زیردسته جدید</a></li>
                                </ul>
                            </li>
                            <li><a href="category.html">رومیزی</a> <span class="down"></span>
                                <ul>
                                    <li><a href="category.html">زیردسته های جدید</a></li>
                                    <li><a href="category.html">زیردسته جدید</a></li>
                                    <li><a href="category.html">زیردسته جدید</a></li>
                                </ul>
                            </li>
                            <li><a href="category.html">دوربین</a> <span class="down"></span>
                                <ul>
                                    <li><a href="category.html">زیردسته های جدید</a></li>
                                </ul>
                            </li>
                            <li><a href="category.html">موبایل و تبلت</a> <span class="down"></span>
                                <ul>
                                    <li><a href="category.html">زیردسته های جدید</a></li>
                                    <li><a href="category.html">زیردسته های جدید</a></li>
                                </ul>
                            </li>
                            <li><a href="category.html">صوتی و تصویری</a> <span class="down"></span>
                                <ul>
                                    <li><a href="category.html">زیردسته های جدید</a></li>
                                    <li><a href="category.html">زیردسته جدید</a></li>
                                </ul>
                            </li>
                            <li><a href="category.html">لوازم خانگی</a></li>
                        </ul>
                    </li>
                    <li><a href="category.html">کفش</a> <span class="down"></span>
                        <ul>
                            <li><a href="category.html">آقایان</a></li>
                            <li><a href="category.html">بانوان</a> <span class="down"></span>
                                <ul>
                                    <li><a href="category.html">زیردسته های جدید</a></li>
                                    <li><a href="category.html">زیردسته ها</a></li>
                                </ul>
                            </li>
                            <li><a href="category.html">دخترانه</a></li>
                            <li><a href="category.html">پسرانه</a></li>
                            <li><a href="category.html">نوزاد</a></li>
                            <li><a href="category.html">لوازم</a><span class="down"></span>
                                <ul>
                                    <li><a href="category.html">زیردسته های جدید</a></li>
                                    <li><a href="category.html">زیردسته های جدید</a></li>
                                    <li><a href="category.html">زیردسته ها</a></li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li><a href="category.html">ساعت</a> <span class="down"></span>
                        <ul>
                            <li><a href="category.html">ساعت مردانه</a></li>
                            <li><a href="category.html">ساعت زنانه</a></li>
                            <li><a href="category.html">ساعت بچگانه</a></li>
                            <li><a href="category.html">لوازم</a></li>
                        </ul>
                    </li>
                    <li><a href="category.html">زیبایی و سلامت</a> <span class="down"></span>
                        <ul>
                            <li><a href="category.html">عطر و ادکلن</a></li>
                            <li><a href="category.html">آرایشی</a></li>
                            <li><a href="category.html">ضد آفتاب</a></li>
                            <li><a href="category.html">مراقبت از پوست</a></li>
                            <li><a href="category.html">مراقبت از چشم</a></li>
                            <li><a href="category.html">مراقبت از مو</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
            <h3 class="subtitle">پرفروش ها</h3>
            <div class="side-item">
                <div class="product-thumb clearfix">
                    <div class="image"><a href="product.html"><img alt="تی شرت کتان مردانه"
                                                                   class="img-responsive"
                                                                   src="/image/product/apple_cinema_30-50x75.jpg"
                                                                   title="تی شرت کتان مردانه"/></a></div>
                    <div class="caption">
                        <h4><a href="product.html">تی شرت کتان مردانه</a></h4>
                        <p class="price"><span class="price-new">110000 تومان</span> <span class="price-old">122000 تومان</span>
                            <span class="saving">-10%</span></p>
                    </div>
                </div>
                <div class="product-thumb clearfix">
                    <div class="image"><a href="product.html"><img alt="آیفون 7" class="img-responsive"
                                                                   src="/image/product/iphone_1-50x75.jpg"
                                                                   title="آیفون 7"/></a></div>
                    <div class="caption">
                        <h4><a href="product.html">آیفون 7</a></h4>
                        <p class="price"> 2200000 تومان </p>
                        <div class="rating"><span class="fa fa-stack"><i class="fa fa-star fa-stack-2x"></i><i
                            class="fa fa-star-o fa-stack-2x"></i></span> <span class="fa fa-stack"><i
                            class="fa fa-star fa-stack-2x"></i><i class="fa fa-star-o fa-stack-2x"></i></span> <span
                            class="fa fa-stack"><i class="fa fa-star fa-stack-2x"></i><i
                            class="fa fa-star-o fa-stack-2x"></i></span> <span class="fa fa-stack"><i
                            class="fa fa-star fa-stack-2x"></i><i class="fa fa-star-o fa-stack-2x"></i></span> <span
                            class="fa fa-stack"><i class="fa fa-star-o fa-stack-2x"></i></span></div>
                    </div>
                </div>
                <div class="product-thumb clearfix">
                    <div class="image"><a href="product.html"><img alt="آیدیا پد یوگا"
                                                                   class="img-responsive"
                                                                   src="/image/product/macbook_1-50x75.jpg"
                                                                   title="آیدیا پد یوگا"/></a></div>
                    <div class="caption">
                        <h4><a href="product.html">آیدیا پد یوگا</a></h4>
                        <p class="price"> 900000 تومان </p>
                        <div class="rating"><span class="fa fa-stack"><i class="fa fa-star fa-stack-2x"></i><i
                            class="fa fa-star-o fa-stack-2x"></i></span> <span class="fa fa-stack"><i
                            class="fa fa-star fa-stack-2x"></i><i class="fa fa-star-o fa-stack-2x"></i></span> <span
                            class="fa fa-stack"><i class="fa fa-star fa-stack-2x"></i><i
                            class="fa fa-star-o fa-stack-2x"></i></span> <span class="fa fa-stack"><i
                            class="fa fa-star fa-stack-2x"></i><i class="fa fa-star-o fa-stack-2x"></i></span> <span
                            class="fa fa-stack"><i class="fa fa-star-o fa-stack-2x"></i></span></div>
                    </div>
                </div>
                <div class="product-thumb clearfix">
                    <div class="image"><a href="product.html"><img alt="کفش راحتی مردانه"
                                                                   class="img-responsive"
                                                                   src="/image/product/sony_vaio_1-50x75.jpg"
                                                                   title="کفش راحتی مردانه"/></a></div>
                    <div class="caption">
                        <h4><a href="product.html">کفش راحتی مردانه</a></h4>
                        <p class="price"><span class="price-new">32000 تومان</span> <span class="price-old">12 میلیون تومان</span>
                            <span class="saving">-25%</span></p>
                        <div class="rating"><span class="fa fa-stack"><i class="fa fa-star fa-stack-2x"></i><i
                            class="fa fa-star-o fa-stack-2x"></i></span> <span class="fa fa-stack"><i
                            class="fa fa-star fa-stack-2x"></i><i class="fa fa-star-o fa-stack-2x"></i></span> <span
                            class="fa fa-stack"><i class="fa fa-star fa-stack-2x"></i><i
                            class="fa fa-star-o fa-stack-2x"></i></span> <span class="fa fa-stack"><i
                            class="fa fa-star fa-stack-2x"></i><i class="fa fa-star-o fa-stack-2x"></i></span> <span
                            class="fa fa-stack"><i class="fa fa-star-o fa-stack-2x"></i></span></div>
                    </div>
                </div>
                <div class="product-thumb clearfix">
                    <div class="image"><a href="product.html"><img
                        alt="دوربین فاین پیکس" class="img-responsive"
                        src="/image/product/FinePix-Long-Zoom-Camera-50x75.jpg" title="دوربین فاین پیکس"/></a></div>
                    <div class="caption">
                        <h4><a href="product.html">دوربین فاین پیکس</a></h4>
                        <p class="price">122000 تومان</p>
                    </div>
                </div>
            </div>
            <h3 class="subtitle">ویژه</h3>
            <div class="side-item">
                <div class="product-thumb clearfix">
                    <div class="image"><a href="product.html"><img alt=" کتاب آموزش باغبانی "
                                                                   class="img-responsive"
                                                                   src="/image/product/macbook_pro_1-50x75.jpg"
                                                                   title=" کتاب آموزش باغبانی "/></a>
                    </div>
                    <div class="caption">
                        <h4><a href="product.html">کتاب آموزش باغبانی</a></h4>
                        <p class="price"><span class="price-new">98000 تومان</span> <span
                            class="price-old">120000 تومان</span> <span class="saving">-26%</span></p>
                    </div>
                </div>
                <div class="product-thumb clearfix">
                    <div class="image"><a href="product.html"><img alt="تبلت ایسر"
                                                                   class="img-responsive"
                                                                   src="/image/product/samsung_tab_1-50x75.jpg"
                                                                   title="تبلت ایسر"/></a></div>
                    <div class="caption">
                        <h4><a href="product.html">تبلت ایسر</a></h4>
                        <p class="price"><span class="price-new">98000 تومان</span> <span
                            class="price-old">240000 تومان</span> <span class="saving">-5%</span></p>
                        <div class="rating"><span class="fa fa-stack"><i class="fa fa-star fa-stack-2x"></i><i
                            class="fa fa-star-o fa-stack-2x"></i></span> <span class="fa fa-stack"><i
                            class="fa fa-star fa-stack-2x"></i><i class="fa fa-star-o fa-stack-2x"></i></span> <span
                            class="fa fa-stack"><i class="fa fa-star fa-stack-2x"></i><i
                            class="fa fa-star-o fa-stack-2x"></i></span> <span class="fa fa-stack"><i
                            class="fa fa-star fa-stack-2x"></i><i class="fa fa-star-o fa-stack-2x"></i></span> <span
                            class="fa fa-stack"><i class="fa fa-star-o fa-stack-2x"></i></span></div>
                    </div>
                </div>
                <div class="product-thumb clearfix">
                    <div class="image"><a href="product.html"><img alt="تی شرت کتان مردانه"
                                                                   class="img-responsive"
                                                                   src="/image/product/apple_cinema_30-50x75.jpg"
                                                                   title="تی شرت کتان مردانه"/></a></div>
                    <div class="caption">
                        <h4><a
                            href="http://demo.harnishdesign.net/opencart/marketshop/v1/index.php?route=product/product&amp;product_id=42">تی
                            شرت کتان مردانه</a></h4>
                        <p class="price"><span class="price-new">110000 تومان</span> <span class="price-old">122000 تومان</span>
                            <span class="saving">-10%</span></p>
                    </div>
                </div>
                <div class="product-thumb clearfix">
                    <div class="image"><a href="product.html"><img alt="دوربین دیجیتال حرفه ای"
                                                                   class="img-responsive"
                                                                   src="/image/product/nikon_d300_1-50x75.jpg"
                                                                   title="دوربین دیجیتال حرفه ای"/></a></div>
                    <div class="caption">
                        <h4><a href="product.html">دوربین دیجیتال حرفه ای</a></h4>
                        <p class="price"><span class="price-new">92000 تومان</span> <span
                            class="price-old">98000 تومان</span> <span class="saving">-6%</span></p>
                    </div>
                </div>
                <div class="product-thumb clearfix">
                    <div class="image"><a href="product.html"><img alt="محصولات مراقبت از مو"
                                                                   class="img-responsive"
                                                                   src="/image/product/nikon_d300_5-50x75.jpg"
                                                                   title="محصولات مراقبت از مو"/></a>
                    </div>
                    <div class="caption">
                        <h4><a href="product.html">محصولات مراقبت از مو</a></h4>
                        <p class="price"><span class="price-new">66000 تومان</span> <span
                            class="price-old">90000 تومان</span> <span class="saving">-27%</span></p>
                        <div class="rating"><span class="fa fa-stack"><i class="fa fa-star fa-stack-2x"></i><i
                            class="fa fa-star-o fa-stack-2x"></i></span> <span class="fa fa-stack"><i
                            class="fa fa-star-o fa-stack-2x"></i></span> <span class="fa fa-stack"><i
                            class="fa fa-star-o fa-stack-2x"></i></span> <span class="fa fa-stack"><i
                            class="fa fa-star-o fa-stack-2x"></i></span> <span class="fa fa-stack"><i
                            class="fa fa-star-o fa-stack-2x"></i></span></div>
                    </div>
                </div>
                <div class="product-thumb clearfix">
                    <div class="image"><a href="product.html"><img alt="لپ تاپ ایلین ور"
                                                                   class="img-responsive"
                                                                   src="/image/product/macbook_air_1-50x75.jpg"
                                                                   title="لپ تاپ ایلین ور"/></a></div>
                    <div class="caption">
                        <h4><a href="product.html">لپ تاپ ایلین ور</a></h4>
                        <p class="price"><span class="price-new">10 میلیون تومان</span> <span class="price-old">12 میلیون تومان</span>
                            <span class="saving">-5%</span></p>
                    </div>
                </div>
            </div>
            <div class="banner owl-carousel">
                <div class="item"><a href="#"><img alt="small banner" class="img-responsive"
                                                   src="/image/banner/small-banner1-265x350.jpg"/></a></div>
                <div class="item"><a href="#"><img alt="small banner1" class="img-responsive"
                                                   src="/image/banner/small-banner-265x350.jpg"/></a></div>
            </div>
        </aside>
        <!--Left Part End -->
        <!--Middle Part Start-->
        <div id="content" class="col-sm-9">
            <h1 class="title"><a href="">{{ category.name }}</a></h1>

            <div>
                <div class="product-filter">
                    <div class="row">
                        <div class="col-md-4 col-sm-5">
                            <div class="btn-group">
                                <button id="list-view" class="btn btn-default" data-original-title="List"
                                        data-toggle="tooltip"
                                        title="" type="button"><i class="fa fa-th-list"></i>
                                </button>
                                <button id="grid-view" class="btn btn-default selected" data-original-title="Grid"
                                        data-toggle="tooltip" title="" type="button"><i class="fa fa-th"></i>
                                </button>
                            </div>
                            <a id="compare-total" href="compare.html">محصولات مقایسه (0)</a>
                        </div>
                        <div class="col-sm-2 text-right">
                            <label class="control-label" for="input-sort">مرتب سازی :</label>
                        </div>
                        <div class="col-md-3 col-sm-3 text-right">
                            <select id="input-sort" class="form-control col-sm-3" v-model="sort" @change="getSortedProducts">
                                <option selected="selected" value="">پیشفرض</option>
                                <option value="ASC">قیمت (کم به زیاد)</option>
                                <option value="DESC">قیمت (زیاد به کم)</option>
                            </select>
                        </div>
                        <div class="col-sm-1 text-right">
                            <label class="control-label" for="input-limit">نمایش :</label>
                        </div>
                        <div class="col-sm-2 text-right">
                            <select id="input-limit" class="form-control" v-model="paginate" @change="getPaginatedProducts">
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </div>
                    </div>
                </div>
                <br/>
                <div class="row products-category">
                    <div v-for="product in products.data"
                         class="product-layout product-layout product-grid col-lg-3 col-md-3 col-sm-4 col-xs-12">
                        <div class="product-thumb clearfix">
                            <div class="image">
                                <a :href="/products/+product.slug">
                                    <img :alt="product.title"
                                         :src="'/storage/photos/' + product.photos[0].path" :title="product.title"
                                         class="img-responsive"/>
                                </a>
                            </div>
                            <div>
                                <div class="caption">
                                    <h4><a href="#"> {{ product.title }} </a></h4>
                                    <p class="description"> آخرین دستاورد های روز دنیا

                                        شامل تمام اطلاعاتی که به آن نیاز خواهید داشت ...</p>

                                    <p v-if="product.discount_price" class="price">
                                        <span class="price-new">{{ product.discount_price }} تومان</span>
                                        <span class="price-old">{{ product.price }} تومان</span>
                                        <span class="saving">%{{
                                                Math.round(Math.abs(((product.price - product.discount_price) / product.price) * 100))
                                            }}</span>
                                    </p>
                                    <p v-if="!product.discount_price" class="price">
                                        <span class="price-new">{{ product.price }} تومان</span>
                                    </p>
                                </div>
                                <div class="button-group">
                                    <a :href="/add-to-cart/ + product.id" class="btn-primary" type="button"><span>افزودن به سبد</span></a>
                                    <div class="add-to-links">
                                        <button data-toggle="tooltip" onClick="" title="افزودن به علاقه مندی ها"
                                                type="button"><i class="fa fa-heart"></i>
                                            <span>افزودن به علاقه مندی ها</span></button>
                                        <button data-toggle="tooltip" onClick="" title="مقایسه این محصول" type="button">
                                            <i class="fa fa-exchange"></i> <span>مقایسه این محصول</span></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row" v-if="products.last_page">
                <div class="col-sm-12 text-center">
                    <paginate
                        v-model="page"
                        :click-handler="clickCallback"
                        :container-class="'pagination'"
                        :margin-pages="3"
                        :next-text="'بعدی'"
                        :page-class="'page-item'"
                        :page-count="this.products.last_page"
                        :page-range="3"
                        :prev-text="'قبلی'">
                    </paginate>
                </div>
            </div>
        </div>
        <!--Middle Part End -->
    </div>
</template>

<script>
export default {
    name: "ProductComponent",
    props: ['category'],
    data() {
        return {
            products : [],
            sort : 'DESC',
            page : 1,
            paginate : 2
        }
    },
    mounted() {
        axios.get('/api/products/' + this.category.id).then(res => {
            this.products = res.data.products
            console.log(this.products)
        }).catch(err => {
            console.log(err)
        })
    },
    methods: {
        clickCallback(pageNum) {
            this.products = []
            if (this.sort == 'ASC' || this.sort == 'DESC')
            {
                this.getSortedProducts()
            }else{
                axios.get('/api/products/' + this.category.id + '?page='+ pageNum).then(res => {
                    this.products = res.data.products
                    console.log(this.products)
                }).catch(err => {
                })
            }

        },
        getSortedProducts(){
            this.products = []
            axios.get('/api/products/' + this.category.id + '/' + this.sort + '/' + this.paginate + '?page='+ this.page).then(res => {
                this.products = res.data.products
                // this.clickCallback(this.page)
                console.log(this.products)
            }).catch(err => {
            })
        },
        getPaginatedProducts(){
            this.products = []
            axios.get('/api/products/' + this.category.id + '/' + this.sort + '/' + this.paginate + '?page='+ this.page).then(res => {
                this.products = res.data.products
                // this.clickCallback(this.page)
                console.log(this.products)
            }).catch(err => {
            })
        }
    }
}

</script>

<style scoped>

</style>
